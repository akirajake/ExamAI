<!DOCTYPE html>
<html lang="ja" class="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="/favicon.ico">
    <title>ExamAI Scheduler</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Tailwind Config -->
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            colors: {
              primary: '#3b82f6',
              secondary: '#8b5cf6',
              background: '#0f172a',
              surface: '#1e293b',
            },
            fontFamily: {
              sans: ['Inter', 'sans-serif'],
            },
          }
        }
      }
    </script>

    <!-- ★★★ APIキー管理 & モデル自動取得スクリプト ★★★ -->
    <script>
      (function() {
        const STORAGE_KEY = 'exam_ai_api_key';
        let apiKey = localStorage.getItem(STORAGE_KEY);
        
        if (!apiKey) {
          apiKey = prompt("Google Gemini APIキーを入力してください\n(キーはブラウザ内にのみ保存されます)");
          if (apiKey) {
            localStorage.setItem(STORAGE_KEY, apiKey);
          }
        }

        // JSファイルから読み込めるようにグローバル公開
        window.GEMINI_API_KEY = apiKey;
        
        // デフォルトモデル（万が一リスト取得に失敗した場合用）
        window.DYNAMIC_MODEL_NAME = "models/gemini-1.5-flash";

        // ★ APIサーバーに問い合わせて、確実に使えるモデル名を取得する
        if (apiKey) {
          console.log("Fetching available models...");
          fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${apiKey}`)
            .then(res => res.json())
            .then(data => {
              if (data.models) {
                // generateContentに対応し、かつ名前が 'gemini' を含む最新のモデルを探す
                const validModel = data.models.find(m => 
                  m.supportedGenerationMethods && 
                  m.supportedGenerationMethods.includes("generateContent") &&
                  m.name.includes("gemini")
                );
                
                if (validModel) {
                  // 正式名称（例: models/gemini-1.5-flash-001）をセット
                  window.DYNAMIC_MODEL_NAME = validModel.name;
                  console.log("✅ Auto-selected model:", window.DYNAMIC_MODEL_NAME);
                } else {
                  console.warn("⚠️ Valid Gemini model not found in list, using default.");
                }
              } else if (data.error) {
                console.error("❌ Model list error:", data.error);
                if (data.error.code === 400) {
                    alert("APIキーが無効です。localStorage.clear() を実行して再設定してください。");
                }
              }
            })
            .catch(e => console.error("❌ Network error fetching models:", e));
        }
      })();
    </script>

    <!-- Styles -->
    <style>
      body { background-color: #0f172a; color: #e2e8f0; }
      .custom-scrollbar::-webkit-scrollbar { width: 6px; height: 6px; }
      .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
      .custom-scrollbar::-webkit-scrollbar-thumb { background-color: #475569; border-radius: 20px; }
      .rbc-calendar { color: #cbd5e1; }
      .rbc-off-range-bg, .rbc-today { background-color: #1e293b !important; }
      .rbc-toolbar button { color: #e2e8f0; border-color: #475569; }
      .rbc-toolbar button:active, .rbc-toolbar button.rbc-active { background-color: #3b82f6; color: white; border-color: #3b82f6; }
      .rbc-header, .rbc-month-view, .rbc-time-view, .rbc-agenda-view, .rbc-timeslot-group, .rbc-time-content, .rbc-time-header-content { border-color: #334155; }
      .glass-effect { background: rgba(15, 23, 42, 0.7); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border-bottom: 1px solid rgba(255, 255, 255, 0.1); }
    </style>

    <link href="https://cdn.jsdelivr.net/npm/react-big-calendar@1.8.5/lib/css/react-big-calendar.css" rel="stylesheet" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- PDF.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
      pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    </script>

    <!-- Vite build JS -->
    <script type="module" crossorigin src="./assets/index-B4GJeJW_.js"></script>
  </head>
  <body>
    <div id="root"></div>
  </body>
</html>
